<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="import_moinmoinpages.py">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>import_moinmoinpages.py | Scientific logbook</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="https://laurentperrinet.github.io/sciblog/listings/import_moinmoinpages.py.html">
<link rel="icon" href="favicon.ico" sizes="16x16">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    },
    displayAlign: 'center', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
<!-- Custom search -->
<form method="get" id="search" action="//duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://laurentperrinet.github.io/sciblog/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->

            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="https://laurentperrinet.github.io/sciblog/">

            <span id="blog-title">Scientific logbook</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="import_moinmoinpages.py" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../index.html" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="../categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="http://laurentperrinet.github.io" class="nav-link">About my research</a>
                </li>
<li class="nav-item">
<a href="https://twitter.com/laurentperrinet" class="nav-link">Twitter</a>
                </li>
<li class="nav-item">
<a href="https://github.com/laurentperrinet" class="nav-link">Github</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        

<nav class="breadcrumbs"><ul class="breadcrumb">
<li class="breadcrumb-item"><a href=".">listings</a></li>
                <li class="breadcrumb-item active">import_moinmoinpages.py</li>
</ul></nav><h1>import_moinmoinpages.py
        <small><a href="import_moinmoinpages.py">(Source)</a></small>
    </h1>
    <table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#listingsimport_moinmoinpagespy-1">  1</a>
<a href="#listingsimport_moinmoinpagespy-2">  2</a>
<a href="#listingsimport_moinmoinpagespy-3">  3</a>
<a href="#listingsimport_moinmoinpagespy-4">  4</a>
<a href="#listingsimport_moinmoinpagespy-5">  5</a>
<a href="#listingsimport_moinmoinpagespy-6">  6</a>
<a href="#listingsimport_moinmoinpagespy-7">  7</a>
<a href="#listingsimport_moinmoinpagespy-8">  8</a>
<a href="#listingsimport_moinmoinpagespy-9">  9</a>
<a href="#listingsimport_moinmoinpagespy-10"> 10</a>
<a href="#listingsimport_moinmoinpagespy-11"> 11</a>
<a href="#listingsimport_moinmoinpagespy-12"> 12</a>
<a href="#listingsimport_moinmoinpagespy-13"> 13</a>
<a href="#listingsimport_moinmoinpagespy-14"> 14</a>
<a href="#listingsimport_moinmoinpagespy-15"> 15</a>
<a href="#listingsimport_moinmoinpagespy-16"> 16</a>
<a href="#listingsimport_moinmoinpagespy-17"> 17</a>
<a href="#listingsimport_moinmoinpagespy-18"> 18</a>
<a href="#listingsimport_moinmoinpagespy-19"> 19</a>
<a href="#listingsimport_moinmoinpagespy-20"> 20</a>
<a href="#listingsimport_moinmoinpagespy-21"> 21</a>
<a href="#listingsimport_moinmoinpagespy-22"> 22</a>
<a href="#listingsimport_moinmoinpagespy-23"> 23</a>
<a href="#listingsimport_moinmoinpagespy-24"> 24</a>
<a href="#listingsimport_moinmoinpagespy-25"> 25</a>
<a href="#listingsimport_moinmoinpagespy-26"> 26</a>
<a href="#listingsimport_moinmoinpagespy-27"> 27</a>
<a href="#listingsimport_moinmoinpagespy-28"> 28</a>
<a href="#listingsimport_moinmoinpagespy-29"> 29</a>
<a href="#listingsimport_moinmoinpagespy-30"> 30</a>
<a href="#listingsimport_moinmoinpagespy-31"> 31</a>
<a href="#listingsimport_moinmoinpagespy-32"> 32</a>
<a href="#listingsimport_moinmoinpagespy-33"> 33</a>
<a href="#listingsimport_moinmoinpagespy-34"> 34</a>
<a href="#listingsimport_moinmoinpagespy-35"> 35</a>
<a href="#listingsimport_moinmoinpagespy-36"> 36</a>
<a href="#listingsimport_moinmoinpagespy-37"> 37</a>
<a href="#listingsimport_moinmoinpagespy-38"> 38</a>
<a href="#listingsimport_moinmoinpagespy-39"> 39</a>
<a href="#listingsimport_moinmoinpagespy-40"> 40</a>
<a href="#listingsimport_moinmoinpagespy-41"> 41</a>
<a href="#listingsimport_moinmoinpagespy-42"> 42</a>
<a href="#listingsimport_moinmoinpagespy-43"> 43</a>
<a href="#listingsimport_moinmoinpagespy-44"> 44</a>
<a href="#listingsimport_moinmoinpagespy-45"> 45</a>
<a href="#listingsimport_moinmoinpagespy-46"> 46</a>
<a href="#listingsimport_moinmoinpagespy-47"> 47</a>
<a href="#listingsimport_moinmoinpagespy-48"> 48</a>
<a href="#listingsimport_moinmoinpagespy-49"> 49</a>
<a href="#listingsimport_moinmoinpagespy-50"> 50</a>
<a href="#listingsimport_moinmoinpagespy-51"> 51</a>
<a href="#listingsimport_moinmoinpagespy-52"> 52</a>
<a href="#listingsimport_moinmoinpagespy-53"> 53</a>
<a href="#listingsimport_moinmoinpagespy-54"> 54</a>
<a href="#listingsimport_moinmoinpagespy-55"> 55</a>
<a href="#listingsimport_moinmoinpagespy-56"> 56</a>
<a href="#listingsimport_moinmoinpagespy-57"> 57</a>
<a href="#listingsimport_moinmoinpagespy-58"> 58</a>
<a href="#listingsimport_moinmoinpagespy-59"> 59</a>
<a href="#listingsimport_moinmoinpagespy-60"> 60</a>
<a href="#listingsimport_moinmoinpagespy-61"> 61</a>
<a href="#listingsimport_moinmoinpagespy-62"> 62</a>
<a href="#listingsimport_moinmoinpagespy-63"> 63</a>
<a href="#listingsimport_moinmoinpagespy-64"> 64</a>
<a href="#listingsimport_moinmoinpagespy-65"> 65</a>
<a href="#listingsimport_moinmoinpagespy-66"> 66</a>
<a href="#listingsimport_moinmoinpagespy-67"> 67</a>
<a href="#listingsimport_moinmoinpagespy-68"> 68</a>
<a href="#listingsimport_moinmoinpagespy-69"> 69</a>
<a href="#listingsimport_moinmoinpagespy-70"> 70</a>
<a href="#listingsimport_moinmoinpagespy-71"> 71</a>
<a href="#listingsimport_moinmoinpagespy-72"> 72</a>
<a href="#listingsimport_moinmoinpagespy-73"> 73</a>
<a href="#listingsimport_moinmoinpagespy-74"> 74</a>
<a href="#listingsimport_moinmoinpagespy-75"> 75</a>
<a href="#listingsimport_moinmoinpagespy-76"> 76</a>
<a href="#listingsimport_moinmoinpagespy-77"> 77</a>
<a href="#listingsimport_moinmoinpagespy-78"> 78</a>
<a href="#listingsimport_moinmoinpagespy-79"> 79</a>
<a href="#listingsimport_moinmoinpagespy-80"> 80</a>
<a href="#listingsimport_moinmoinpagespy-81"> 81</a>
<a href="#listingsimport_moinmoinpagespy-82"> 82</a>
<a href="#listingsimport_moinmoinpagespy-83"> 83</a>
<a href="#listingsimport_moinmoinpagespy-84"> 84</a>
<a href="#listingsimport_moinmoinpagespy-85"> 85</a>
<a href="#listingsimport_moinmoinpagespy-86"> 86</a>
<a href="#listingsimport_moinmoinpagespy-87"> 87</a>
<a href="#listingsimport_moinmoinpagespy-88"> 88</a>
<a href="#listingsimport_moinmoinpagespy-89"> 89</a>
<a href="#listingsimport_moinmoinpagespy-90"> 90</a>
<a href="#listingsimport_moinmoinpagespy-91"> 91</a>
<a href="#listingsimport_moinmoinpagespy-92"> 92</a>
<a href="#listingsimport_moinmoinpagespy-93"> 93</a>
<a href="#listingsimport_moinmoinpagespy-94"> 94</a>
<a href="#listingsimport_moinmoinpagespy-95"> 95</a>
<a href="#listingsimport_moinmoinpagespy-96"> 96</a>
<a href="#listingsimport_moinmoinpagespy-97"> 97</a>
<a href="#listingsimport_moinmoinpagespy-98"> 98</a>
<a href="#listingsimport_moinmoinpagespy-99"> 99</a>
<a href="#listingsimport_moinmoinpagespy-100">100</a>
<a href="#listingsimport_moinmoinpagespy-101">101</a>
<a href="#listingsimport_moinmoinpagespy-102">102</a>
<a href="#listingsimport_moinmoinpagespy-103">103</a>
<a href="#listingsimport_moinmoinpagespy-104">104</a>
<a href="#listingsimport_moinmoinpagespy-105">105</a>
<a href="#listingsimport_moinmoinpagespy-106">106</a>
<a href="#listingsimport_moinmoinpagespy-107">107</a>
<a href="#listingsimport_moinmoinpagespy-108">108</a>
<a href="#listingsimport_moinmoinpagespy-109">109</a>
<a href="#listingsimport_moinmoinpagespy-110">110</a>
<a href="#listingsimport_moinmoinpagespy-111">111</a>
<a href="#listingsimport_moinmoinpagespy-112">112</a>
<a href="#listingsimport_moinmoinpagespy-113">113</a>
<a href="#listingsimport_moinmoinpagespy-114">114</a>
<a href="#listingsimport_moinmoinpagespy-115">115</a>
<a href="#listingsimport_moinmoinpagespy-116">116</a>
<a href="#listingsimport_moinmoinpagespy-117">117</a>
<a href="#listingsimport_moinmoinpagespy-118">118</a>
<a href="#listingsimport_moinmoinpagespy-119">119</a>
<a href="#listingsimport_moinmoinpagespy-120">120</a>
<a href="#listingsimport_moinmoinpagespy-121">121</a>
<a href="#listingsimport_moinmoinpagespy-122">122</a>
<a href="#listingsimport_moinmoinpagespy-123">123</a>
<a href="#listingsimport_moinmoinpagespy-124">124</a>
<a href="#listingsimport_moinmoinpagespy-125">125</a>
<a href="#listingsimport_moinmoinpagespy-126">126</a>
<a href="#listingsimport_moinmoinpagespy-127">127</a>
<a href="#listingsimport_moinmoinpagespy-128">128</a>
<a href="#listingsimport_moinmoinpagespy-129">129</a>
<a href="#listingsimport_moinmoinpagespy-130">130</a>
<a href="#listingsimport_moinmoinpagespy-131">131</a>
<a href="#listingsimport_moinmoinpagespy-132">132</a>
<a href="#listingsimport_moinmoinpagespy-133">133</a>
<a href="#listingsimport_moinmoinpagespy-134">134</a>
<a href="#listingsimport_moinmoinpagespy-135">135</a>
<a href="#listingsimport_moinmoinpagespy-136">136</a>
<a href="#listingsimport_moinmoinpagespy-137">137</a>
<a href="#listingsimport_moinmoinpagespy-138">138</a>
<a href="#listingsimport_moinmoinpagespy-139">139</a>
<a href="#listingsimport_moinmoinpagespy-140">140</a>
<a href="#listingsimport_moinmoinpagespy-141">141</a>
<a href="#listingsimport_moinmoinpagespy-142">142</a>
<a href="#listingsimport_moinmoinpagespy-143">143</a>
<a href="#listingsimport_moinmoinpagespy-144">144</a>
<a href="#listingsimport_moinmoinpagespy-145">145</a>
<a href="#listingsimport_moinmoinpagespy-146">146</a>
<a href="#listingsimport_moinmoinpagespy-147">147</a>
<a href="#listingsimport_moinmoinpagespy-148">148</a>
<a href="#listingsimport_moinmoinpagespy-149">149</a>
<a href="#listingsimport_moinmoinpagespy-150">150</a></pre></div></td>
<td class="code"><pre class="code literal-block"><a name="listingsimport_moinmoinpagespy-1"></a><span class="ch">#!/usr/bin/env python</span>
<a name="listingsimport_moinmoinpagespy-2"></a><span class="c1"># imported from</span>
<a name="listingsimport_moinmoinpagespy-3"></a><span class="c1"># https://github.com/jbarratt/serialized-nikola/blob/master/util/import_octopress_posts.py</span>
<a name="listingsimport_moinmoinpagespy-4"></a><span class="kn">import</span> <span class="nn">sys</span>
<a name="listingsimport_moinmoinpagespy-5"></a><span class="kn">import</span> <span class="nn">os</span>
<a name="listingsimport_moinmoinpagespy-6"></a><span class="kn">import</span> <span class="nn">glob</span>
<a name="listingsimport_moinmoinpagespy-7"></a><span class="kn">import</span> <span class="nn">re</span>
<a name="listingsimport_moinmoinpagespy-8"></a>
<a name="listingsimport_moinmoinpagespy-9"></a>
<a name="listingsimport_moinmoinpagespy-10"></a><span class="k">def</span> <span class="nf">octo_parse</span><span class="p">(</span><span class="n">octo_post</span><span class="p">):</span>
<a name="listingsimport_moinmoinpagespy-11"></a>    <span class="sd">"""</span>
<a name="listingsimport_moinmoinpagespy-12"></a><span class="sd">        Input: an octopress post</span>
<a name="listingsimport_moinmoinpagespy-13"></a><span class="sd">        Output: a tuple of (dict of metadata, string of body)</span>
<a name="listingsimport_moinmoinpagespy-14"></a><span class="sd">    """</span>
<a name="listingsimport_moinmoinpagespy-15"></a>    <span class="n">fm_count</span> <span class="o">=</span> <span class="mi">0</span>
<a name="listingsimport_moinmoinpagespy-16"></a>    <span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
<a name="listingsimport_moinmoinpagespy-17"></a>    <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>
<a name="listingsimport_moinmoinpagespy-18"></a>
<a name="listingsimport_moinmoinpagespy-19"></a>    <span class="n">block_type</span> <span class="o">=</span> <span class="bp">None</span>
<a name="listingsimport_moinmoinpagespy-20"></a>
<a name="listingsimport_moinmoinpagespy-21"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">octo_post</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-22"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
<a name="listingsimport_moinmoinpagespy-23"></a>            <span class="k">if</span> <span class="n">fm_count</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-24"></a>                <span class="c1"># everything after frontmatter is body</span>
<a name="listingsimport_moinmoinpagespy-25"></a>                <span class="c1"># {% img right /images/GiveUpSmall.jpg 180 240 foo %}</span>
<a name="listingsimport_moinmoinpagespy-26"></a>
<a name="listingsimport_moinmoinpagespy-27"></a>                <span class="c1"># Convert octopress image blocks</span>
<a name="listingsimport_moinmoinpagespy-28"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'\s*\{\s*\%\s*img\s*(right)?\s*(\S*)\s*(\d+)?\s*(\d+)?\s*(.*?)\s*\%\s*\}'</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-29"></a>                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-30"></a>                    <span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">alt</span><span class="p">)</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<a name="listingsimport_moinmoinpagespy-31"></a>                    <span class="n">img_tag</span> <span class="o">=</span> <span class="s2">"&lt;img src='</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">source</span>
<a name="listingsimport_moinmoinpagespy-32"></a>                    <span class="k">if</span> <span class="n">right</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-33"></a>                        <span class="n">img_tag</span> <span class="o">+=</span> <span class="s2">" align='right'"</span>
<a name="listingsimport_moinmoinpagespy-34"></a>                    <span class="k">if</span> <span class="n">width</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-35"></a>                        <span class="n">img_tag</span> <span class="o">+=</span> <span class="s2">" width='</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">width</span>
<a name="listingsimport_moinmoinpagespy-36"></a>                    <span class="k">if</span> <span class="n">height</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-37"></a>                        <span class="n">img_tag</span> <span class="o">+=</span> <span class="s2">" height='</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">height</span>
<a name="listingsimport_moinmoinpagespy-38"></a>                    <span class="k">if</span> <span class="n">alt</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-39"></a>                        <span class="n">img_tag</span> <span class="o">+=</span> <span class="s2">" title='</span><span class="si">%s</span><span class="s2">' alt='</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="p">(</span><span class="n">alt</span><span class="p">,</span> <span class="n">alt</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-40"></a>                    <span class="n">img_tag</span> <span class="o">+=</span> <span class="s2">"/&gt;"</span>
<a name="listingsimport_moinmoinpagespy-41"></a>                    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img_tag</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-42"></a>                    <span class="k">continue</span>
<a name="listingsimport_moinmoinpagespy-43"></a>
<a name="listingsimport_moinmoinpagespy-44"></a>                <span class="c1"># convert octopress blockquote and code blocks</span>
<a name="listingsimport_moinmoinpagespy-45"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'\s*\{\s*\%\s*(end)?(\w+)\s*(?:lang:)?(\w+)?\s*\%'</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-46"></a>                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-47"></a>                    <span class="p">(</span><span class="n">ended</span><span class="p">,</span> <span class="n">b_type</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<a name="listingsimport_moinmoinpagespy-48"></a>                    <span class="k">if</span> <span class="n">ended</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-49"></a>                        <span class="k">if</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s2">"codeblock"</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-50"></a>                            <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"```</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-51"></a>                        <span class="n">block_type</span> <span class="o">=</span> <span class="bp">None</span>
<a name="listingsimport_moinmoinpagespy-52"></a>                        <span class="k">continue</span>
<a name="listingsimport_moinmoinpagespy-53"></a>                    <span class="k">else</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-54"></a>                        <span class="n">block_type</span> <span class="o">=</span> <span class="n">b_type</span>
<a name="listingsimport_moinmoinpagespy-55"></a>                        <span class="k">if</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s2">"codeblock"</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-56"></a>                            <span class="n">opener</span> <span class="o">=</span> <span class="s2">"```"</span>
<a name="listingsimport_moinmoinpagespy-57"></a>                            <span class="k">if</span> <span class="n">lang</span> <span class="ow">and</span> <span class="n">lang</span> <span class="o">!=</span> <span class="s2">"text"</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-58"></a>                                <span class="n">opener</span> <span class="o">+=</span> <span class="s2">" </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">lang</span>
<a name="listingsimport_moinmoinpagespy-59"></a>                            <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opener</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-60"></a>                        <span class="k">continue</span>
<a name="listingsimport_moinmoinpagespy-61"></a>
<a name="listingsimport_moinmoinpagespy-62"></a>                <span class="k">if</span> <span class="n">block_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-63"></a>                    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-64"></a>                <span class="k">elif</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s2">"blockquote"</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-65"></a>                    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"&gt; "</span> <span class="o">+</span> <span class="n">l</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-66"></a>                <span class="k">elif</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s2">"codeblock"</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-67"></a>                    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-68"></a>
<a name="listingsimport_moinmoinpagespy-69"></a>            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'^\s*-+\s*$'</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
<a name="listingsimport_moinmoinpagespy-70"></a>                <span class="c1"># YAML frontmatter marker</span>
<a name="listingsimport_moinmoinpagespy-71"></a>                <span class="n">fm_count</span> <span class="o">=</span> <span class="n">fm_count</span> <span class="o">+</span> <span class="mi">1</span>
<a name="listingsimport_moinmoinpagespy-72"></a>            <span class="k">else</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-73"></a>                <span class="c1"># I'm only interested in date and title from</span>
<a name="listingsimport_moinmoinpagespy-74"></a>                <span class="c1"># Octopress frontmatter. Others may want more.</span>
<a name="listingsimport_moinmoinpagespy-75"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'^\s*(date|title): (.*?)$'</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-76"></a>                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-77"></a>                    <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<a name="listingsimport_moinmoinpagespy-78"></a>                    <span class="n">meta</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">'" '</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-79"></a>
<a name="listingsimport_moinmoinpagespy-80"></a>        <span class="c1"># Pull the date out of the filename</span>
<a name="listingsimport_moinmoinpagespy-81"></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">'(\d{4})-(\d{2})-(\d{2})-(.*?).markdown'</span><span class="p">,</span> <span class="n">octo_post</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-82"></a>        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-83"></a>            <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">slug</span><span class="p">)</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<a name="listingsimport_moinmoinpagespy-84"></a>            <span class="k">if</span> <span class="s2">"date"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-85"></a>                <span class="c1"># if it has a date, it's better, because it has time</span>
<a name="listingsimport_moinmoinpagespy-86"></a>                <span class="c1"># if not make something up</span>
<a name="listingsimport_moinmoinpagespy-87"></a>                <span class="n">meta</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2"> 13:37"</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-88"></a>            <span class="k">else</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-89"></a>                <span class="n">meta</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-90"></a>            <span class="n">meta</span><span class="p">[</span><span class="s1">'slug'</span><span class="p">]</span> <span class="o">=</span> <span class="n">slug</span>
<a name="listingsimport_moinmoinpagespy-91"></a>            <span class="n">meta</span><span class="p">[</span><span class="s1">'year'</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>
<a name="listingsimport_moinmoinpagespy-92"></a>            <span class="n">meta</span><span class="p">[</span><span class="s1">'month'</span><span class="p">]</span> <span class="o">=</span> <span class="n">month</span>
<a name="listingsimport_moinmoinpagespy-93"></a>        <span class="k">else</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-94"></a>            <span class="k">print</span> <span class="s2">"warning, can't get slug from </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">octo_post</span>
<a name="listingsimport_moinmoinpagespy-95"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">body</span><span class="p">))</span>
<a name="listingsimport_moinmoinpagespy-96"></a>
<a name="listingsimport_moinmoinpagespy-97"></a>
<a name="listingsimport_moinmoinpagespy-98"></a><span class="k">def</span> <span class="nf">nikola_save</span><span class="p">(</span><span class="n">np_dir</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
<a name="listingsimport_moinmoinpagespy-99"></a>    <span class="sd">"""</span>
<a name="listingsimport_moinmoinpagespy-100"></a><span class="sd">        Input: directory for posts</span>
<a name="listingsimport_moinmoinpagespy-101"></a><span class="sd">               metadata hash</span>
<a name="listingsimport_moinmoinpagespy-102"></a><span class="sd">               body text</span>
<a name="listingsimport_moinmoinpagespy-103"></a>
<a name="listingsimport_moinmoinpagespy-104"></a><span class="sd">        .. title: How to make money</span>
<a name="listingsimport_moinmoinpagespy-105"></a><span class="sd">        .. slug: how-to-make-money</span>
<a name="listingsimport_moinmoinpagespy-106"></a><span class="sd">        .. date: 2012/09/15 19:52:05</span>
<a name="listingsimport_moinmoinpagespy-107"></a><span class="sd">        .. tags:</span>
<a name="listingsimport_moinmoinpagespy-108"></a><span class="sd">        .. link:</span>
<a name="listingsimport_moinmoinpagespy-109"></a><span class="sd">        .. description:</span>
<a name="listingsimport_moinmoinpagespy-110"></a><span class="sd">    """</span>
<a name="listingsimport_moinmoinpagespy-111"></a>
<a name="listingsimport_moinmoinpagespy-112"></a>    <span class="n">newdir</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">np_dir</span><span class="p">,</span> <span class="n">meta</span><span class="p">[</span><span class="s1">'year'</span><span class="p">],</span> <span class="n">meta</span><span class="p">[</span><span class="s1">'month'</span><span class="p">])</span>
<a name="listingsimport_moinmoinpagespy-113"></a>    <span class="c1"># make this an index so we end up with YYYY/MM/&lt;slug&gt;.extension</span>
<a name="listingsimport_moinmoinpagespy-114"></a>    <span class="k">try</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-115"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">newdir</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-116"></a>    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-117"></a>        <span class="k">pass</span>
<a name="listingsimport_moinmoinpagespy-118"></a>
<a name="listingsimport_moinmoinpagespy-119"></a>    <span class="n">newfile</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.md"</span> <span class="o">%</span> <span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">'slug'</span><span class="p">],</span> <span class="n">newdir</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-120"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">newfile</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-121"></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'&lt;!--</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-122"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'date'</span><span class="p">,</span> <span class="s1">'slug'</span><span class="p">]:</span>
<a name="listingsimport_moinmoinpagespy-123"></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'.. </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">meta</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
<a name="listingsimport_moinmoinpagespy-124"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'tags'</span><span class="p">,</span> <span class="s1">'link'</span><span class="p">,</span> <span class="s1">'description'</span><span class="p">]:</span>
<a name="listingsimport_moinmoinpagespy-125"></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'.. </span><span class="si">%s</span><span class="s1">:</span><span class="se">\n</span><span class="s1">'</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-126"></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'--&gt;</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-127"></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="n">body</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-128"></a>
<a name="listingsimport_moinmoinpagespy-129"></a>
<a name="listingsimport_moinmoinpagespy-130"></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a name="listingsimport_moinmoinpagespy-131"></a>    <span class="sd">"""</span>
<a name="listingsimport_moinmoinpagespy-132"></a><span class="sd">        Input: octopress posts directory</span>
<a name="listingsimport_moinmoinpagespy-133"></a><span class="sd">        Output: nikola posts directory</span>
<a name="listingsimport_moinmoinpagespy-134"></a>
<a name="listingsimport_moinmoinpagespy-135"></a><span class="sd">        For each file</span>
<a name="listingsimport_moinmoinpagespy-136"></a><span class="sd">            * strip the yaml front matter</span>
<a name="listingsimport_moinmoinpagespy-137"></a><span class="sd">            * parse the file name to fill in missing bits of the front matter</span>
<a name="listingsimport_moinmoinpagespy-138"></a><span class="sd">            * fill in nikola front matter</span>
<a name="listingsimport_moinmoinpagespy-139"></a><span class="sd">            * rename from YYYY-MM-DD-&lt;slug&gt;.markdown to YYYY/MM/&lt;slug&gt;.md</span>
<a name="listingsimport_moinmoinpagespy-140"></a><span class="sd">    """</span>
<a name="listingsimport_moinmoinpagespy-141"></a>    <span class="n">op_dir</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a name="listingsimport_moinmoinpagespy-142"></a>    <span class="n">np_dir</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a name="listingsimport_moinmoinpagespy-143"></a>
<a name="listingsimport_moinmoinpagespy-144"></a>    <span class="k">for</span> <span class="n">op_file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1">/*.markdown'</span> <span class="o">%</span> <span class="n">op_dir</span><span class="p">):</span>
<a name="listingsimport_moinmoinpagespy-145"></a>        <span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span> <span class="o">=</span> <span class="n">octo_parse</span><span class="p">(</span><span class="n">op_file</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-146"></a>        <span class="n">nikola_save</span><span class="p">(</span><span class="n">np_dir</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
<a name="listingsimport_moinmoinpagespy-147"></a>
<a name="listingsimport_moinmoinpagespy-148"></a>
<a name="listingsimport_moinmoinpagespy-149"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
<a name="listingsimport_moinmoinpagespy-150"></a>    <span class="n">main</span><span class="p">()</span>
</pre></td>
</tr></table>
<!--End of body content--><footer id="footer">
            Contents © 2019 <a href="mailto:laurent.perrinet@univ-amu.fr">Laurent Perrinet</a> -
Powered by <a href="http://getnikola.com">Nikola</a> with <a href="https://themes.getnikola.com/v7/maupassant/">Maupassant</a> theme <br><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/ar/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="http://i.creativecommons.org/l/by-nc-sa/2.5/ar/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
