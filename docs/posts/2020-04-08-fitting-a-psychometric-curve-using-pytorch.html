<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>2020-04-08 fitting a psychometric curve using pyTorch | Scientific logbook</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="https://laurentperrinet.github.io/sciblog/posts/2020-04-08-fitting-a-psychometric-curve-using-pytorch.html">
<link rel="icon" href="favicon.ico" sizes="16x16">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    },
    displayAlign: 'center', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><meta name="author" content="Laurent Perrinet">
<link rel="prev" href="2020-01-08-changing-the-global-phase-of-a-motion-cloud.html" title="Changing the global phase of a Motion Cloud" type="text/html">
<meta property="og:site_name" content="Scientific logbook">
<meta property="og:title" content="2020-04-08 fitting a psychometric curve using pyTorch">
<meta property="og:url" content="https://laurentperrinet.github.io/sciblog/posts/2020-04-08-fitting-a-psychometric-curve-using-pytorch.html">
<meta property="og:description" content="The goal here is to compare methods which fit data with psychometric curves using logistic regression. Indeed, after (long) experiments where for instance you collected sequences of keypresses, it is ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-04-08T16:29:06+02:00">
<meta property="article:tag" content="numpy">
<meta property="article:tag" content="open-science">
<meta property="article:tag" content="orientation">
<meta property="article:tag" content="psychophysics">
<meta property="article:tag" content="pytorch">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
<!-- Custom search -->
<form method="get" id="search" action="//duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://laurentperrinet.github.io/sciblog/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->

            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="https://laurentperrinet.github.io/sciblog/">

            <span id="blog-title">Scientific logbook</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.ipynb" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../index.html" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="../categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="http://laurentperrinet.github.io" class="nav-link">About my research</a>
                </li>
<li class="nav-item">
<a href="https://twitter.com/laurentperrinet" class="nav-link">Twitter</a>
                </li>
<li class="nav-item">
<a href="https://github.com/laurentperrinet" class="nav-link">Github</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">2020-04-08 fitting a psychometric curve using pyTorch</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Laurent Perrinet
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2020-04-08T16:29:06+02:00" itemprop="datePublished" title="2020-04-08 16:29">2020-04-08 16:29</time></a>
            </p>
                <p class="commentline">
        
    <a href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#disqus_thread" data-disqus-identifier="cache/posts/2020-04-08-fitting-a-psychometric-curve-using-pytorch.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The goal here is to compare methods which fit data with psychometric curves using logistic regression. Indeed, after (long) experiments where for instance you collected sequences of keypresses, it is important to infer at best the parameters of the underlying processes: was the observer biased, was she more precise? While I was <em>forevever</em> using <a href="https://scikit-learn.org/stable/index.html">sklearn</a> and praised it's beautifully crafted methods, I lacked some flexibility in the definition of the model. This notebook was done in collaboration with <a href="https://github.com/jennafradin">Jenna Fradin</a>, master student in the lab.</p>
<p>Here, I define a similar fitting method using <a href="https://pytorch.org/">pytorch</a> which fits in a few lines of code :</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">TensorDataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="n">torch</span><span class="o">.</span><span class="n">set_default_tensor_type</span><span class="p">(</span><span class="s1">'torch.DoubleTensor'</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BCELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s1">'sum'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">LogisticRegressionModel</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logit0</span><span class="o">=-</span><span class="mi">3</span><span class="p">):</span> 
        <span class="nb">super</span><span class="p">(</span><span class="n">LogisticRegressionModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">bias</span><span class="p">)</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">logit0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">logit0</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logit0</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">p0</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">out</span>

<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.999</span>
<span class="n">betas</span> <span class="o">=</span> <span class="p">(</span><span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">)</span>
<span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">512</span>
<span class="c1">#num_epochs = 128 # DEBUG</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">8</span>

<span class="k">def</span> <span class="nf">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> 
                <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span>
                <span class="n">num_epochs</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="n">betas</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">logistic_model</span> <span class="o">=</span> <span class="n">LogisticRegressionModel</span><span class="p">()</span>

    <span class="n">Theta</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">theta</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>

    <span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">TensorDataset</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">labels</span><span class="p">),</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">logistic_model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="p">),</span> <span class="n">betas</span><span class="o">=</span><span class="n">betas</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">)):</span>
        <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">Theta_</span><span class="p">,</span> <span class="n">labels_</span> <span class="ow">in</span> <span class="n">loader</span><span class="p">:</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="p">(</span><span class="n">Theta_</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">labels_</span><span class="p">)</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="p">(</span><span class="n">epoch</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_epochs</span><span class="o">//</span><span class="mi">32</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Iteration: </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2"> - Loss: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">logistic_model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">Theta</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">theta</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and run a series of tests to compare both methods.</p>
<!-- TEASER_END -->

<p>Let's first initialize the notebook:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="c1">#print(rcParams)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">'font.size'</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontsize</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">'legend.fontsize'</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontsize</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">'axes.labelsize'</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontsize</span>
    
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some hyper parameters which we will tune later:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">200</span>            
<span class="n">batch_size</span> <span class="o">=</span> <span class="n">N</span><span class="o">//</span><span class="mi">4</span>
<span class="c1">#batch_size = N//2</span>

<span class="n">N_cv</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># N_cv = 2</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">N_scan</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">N_test</span> <span class="o">=</span> <span class="mi">2000</span> <span class="c1"># number of points for validation</span>

<span class="n">bias</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">p0</span> <span class="o">=</span> <span class="mf">0.02</span>         
<span class="n">theta0</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">wt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">20</span>      
<span class="n">theta_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="problem-statement:-a-2aFC-task-on-synthetic-data">problem statement: a 2aFC task on synthetic data<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#problem-statement:-a-2aFC-task-on-synthetic-data">¶</a>
</h3>
<p>We will generate a typical setup where we have to guess for the otientation of a visual display compared to the vertical and ask observer to either press on the <code>left</code> or <code>right</code> arrows. The visual display will be controlled by a $theta$ parameter which we draw randomly according to a Gaussian probability density function. This may be synthesized in the following function:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">psychometric_function</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span>
                            <span class="n">p0</span> <span class="o">=</span> <span class="n">p0</span><span class="p">,</span>
                            <span class="n">theta0</span> <span class="o">=</span> <span class="n">theta0</span><span class="p">,</span>
                            <span class="n">wt</span> <span class="o">=</span> <span class="n">wt</span><span class="p">,</span>
                            <span class="p">):</span>
    <span class="k">return</span> <span class="n">p0</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">theta</span><span class="o">-</span><span class="n">theta0</span><span class="p">)</span><span class="o">/</span><span class="n">wt</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p0</span><span class="p">,</span>
            <span class="n">theta0</span> <span class="o">=</span> <span class="n">theta0</span><span class="p">,</span>
            <span class="n">wt</span> <span class="o">=</span> <span class="n">wt</span><span class="p">,</span>
            <span class="n">theta_std</span> <span class="o">=</span> <span class="n">theta_std</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">):</span>    
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">theta_std</span>
    
    <span class="n">p</span> <span class="o">=</span> <span class="n">psychometric_function</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">theta0</span><span class="p">,</span> <span class="n">wt</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">p</span> <span class="c1">#generate data</span>
    <span class="k">return</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>it
<span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The slowest run took 6.84 times longer than the fastest. This could mean that an intermediate result is being cached.
211 µs ± 93.9 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
<span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Final loss ="</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Iteration: 0 - Loss: 0.65580
Iteration: 16 - Loss: 0.59306
Iteration: 32 - Loss: 0.54721
Iteration: 48 - Loss: 0.51284
Iteration: 64 - Loss: 0.48632
Iteration: 80 - Loss: 0.46525
Iteration: 96 - Loss: 0.44787
Iteration: 112 - Loss: 0.43315
Iteration: 128 - Loss: 0.42058
Iteration: 144 - Loss: 0.40961
Iteration: 160 - Loss: 0.40015
Iteration: 176 - Loss: 0.39187
Iteration: 192 - Loss: 0.38467
Iteration: 208 - Loss: 0.37840
Iteration: 224 - Loss: 0.37299
Iteration: 240 - Loss: 0.36821
Iteration: 256 - Loss: 0.36419
Iteration: 272 - Loss: 0.36067
Iteration: 288 - Loss: 0.35761
Iteration: 304 - Loss: 0.35497
Iteration: 320 - Loss: 0.35269
Iteration: 336 - Loss: 0.35074
Iteration: 352 - Loss: 0.34907
Iteration: 368 - Loss: 0.34765
Iteration: 384 - Loss: 0.34645
Iteration: 400 - Loss: 0.34537
Iteration: 416 - Loss: 0.34447
Iteration: 432 - Loss: 0.34369
Iteration: 448 - Loss: 0.34301
Iteration: 464 - Loss: 0.34242
Iteration: 480 - Loss: 0.34193
Iteration: 496 - Loss: 0.34149
Final loss = 0.3410759062834651
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'p0 = </span><span class="si">{</span><span class="n">p0</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, theta0 = </span><span class="si">{</span><span class="n">theta0</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, wt = </span><span class="si">{</span><span class="n">wt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, theta_std = </span><span class="si">{</span><span class="n">theta_std</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>p0 = 0.020, theta0 = 0.000, wt = 0.157, theta_std = 0.524
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">theta0_</span> <span class="o">=</span> <span class="o">-</span><span class="n">logistic_model</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">/</span><span class="n">logistic_model</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">wt_</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">logistic_model</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">p0_</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">logistic_model</span><span class="o">.</span><span class="n">logit0</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bias</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'theta0 = </span><span class="si">{</span><span class="n">theta0_</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span> <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'slope = </span><span class="si">{</span><span class="n">wt_</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>    
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'p0 = </span><span class="si">{</span><span class="n">p0_</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>        
    <span class="k">return</span> <span class="n">theta0_</span><span class="p">,</span> <span class="n">wt_</span><span class="p">,</span> <span class="n">p0_</span>

<span class="n">theta0_</span><span class="p">,</span> <span class="n">wt_</span><span class="p">,</span> <span class="n">p0_</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>theta0 = 0.006
slope = 0.168
p0 = 0.002
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That method is fairly quick, in under 2 seconds:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>it
<span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>14.6 s ± 3.81 s per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>let's do the same thing with <code>sklearn</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mf">1.e-4</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="k">def</span> <span class="nf">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> 
                <span class="n">num_epochs</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span>
                <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> 
                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">logistic_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">'liblinear'</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">logistic_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">theta</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">y</span><span class="p">)</span>
    
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">theta</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">outputs_</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">outputs</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs_</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Loss ="</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Loss = 0.34461827952674307
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_params_sk</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="n">theta0_</span> <span class="o">=</span> <span class="o">-</span><span class="n">logistic_model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">logistic_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">wt_</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">logistic_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bias</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'theta0 = </span><span class="si">{</span><span class="n">theta0_</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span> <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'slope = </span><span class="si">{</span><span class="n">wt_</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>    
    <span class="k">return</span> <span class="n">theta0_</span><span class="p">,</span> <span class="n">wt_</span>

<span class="n">theta0_</span><span class="p">,</span> <span class="n">wt_</span> <span class="o">=</span> <span class="n">get_params_sk</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>theta0 = 0.006
slope = 0.183
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That method is <em>much</em> quicker:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>it
<span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>1.5 ms ± 412 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>... but what is the value of few seconds after hours of having observers sitting in front of a screen looking at (often boring) visual displays? More seriously, most important is the reliability of the values which are inferred by each respective method, such that they are correctly reflecting the information contained in the data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="qualitative-comparison-of-methods">qualitative comparison of methods<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#qualitative-comparison-of-methods">¶</a>
</h3>
<p>We can synthesize this comparison by drawing a new dataset and plotting the psychometric curves which are obtained by each method</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span> <span class="c1"># nouvelles données </span>
<span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Training loss = </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_sk</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Training sklearn loss = </span><span class="si">{</span><span class="n">loss_sk</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Training loss = 0.342
Training sklearn loss = 0.345
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'data points'</span><span class="p">)</span>
<span class="c1"># ax.scatter(theta, p, s=6, alpha=.4, color = 'b', label='hidden proba')</span>
<span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">y_values_p</span> <span class="o">=</span> <span class="n">psychometric_function</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">theta0</span><span class="p">,</span> <span class="n">wt</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values_p</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'hidden proba'</span><span class="p">)</span>
<span class="n">y_values</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">x_values</span><span class="p">))</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">y_values_sk</span> <span class="o">=</span> <span class="n">logistic_model_sk</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_values</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values_sk</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'sklearn'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'orientation $\theta$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">'Left'</span><span class="p">,</span> <span class="s1">'Right'</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">6</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-17-c43756367c3b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> x_values <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>linspace<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.5</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1.50</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">100</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> y_values_p <span class="ansi-blue-fg">=</span> psychometric_function<span class="ansi-blue-fg">(</span>theta<span class="ansi-blue-fg">,</span> p0<span class="ansi-blue-fg">,</span> theta0<span class="ansi-blue-fg">,</span> wt<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 6</span><span class="ansi-red-fg"> </span>ax<span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>x_values<span class="ansi-blue-fg">,</span> y_values_p<span class="ansi-blue-fg">,</span> alpha<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">.4</span><span class="ansi-blue-fg">,</span> color <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">'b'</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">'hidden proba'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> y_values <span class="ansi-blue-fg">=</span> logistic_model<span class="ansi-blue-fg">(</span>torch<span class="ansi-blue-fg">.</span>Tensor<span class="ansi-blue-fg">(</span>x_values<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>detach<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>numpy<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> ax<span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>x_values<span class="ansi-blue-fg">,</span> y_values<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">'g'</span><span class="ansi-blue-fg">,</span> alpha<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">.7</span><span class="ansi-blue-fg">,</span> lw<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">'torch'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/site-packages/matplotlib/axes/_axes.py</span> in <span class="ansi-cyan-fg">plot</span><span class="ansi-blue-fg">(self, scalex, scaley, data, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1644</span>         """
<span class="ansi-green-intense-fg ansi-bold">   1645</span>         kwargs <span class="ansi-blue-fg">=</span> cbook<span class="ansi-blue-fg">.</span>normalize_kwargs<span class="ansi-blue-fg">(</span>kwargs<span class="ansi-blue-fg">,</span> mlines<span class="ansi-blue-fg">.</span>Line2D<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 1646</span><span class="ansi-red-fg">         </span>lines <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">*</span>self<span class="ansi-blue-fg">.</span>_get_lines<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">=</span>data<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">   1647</span>         <span class="ansi-green-fg">for</span> line <span class="ansi-green-fg">in</span> lines<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1648</span>             self<span class="ansi-blue-fg">.</span>add_line<span class="ansi-blue-fg">(</span>line<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/site-packages/matplotlib/axes/_base.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    214</span>                 this <span class="ansi-blue-fg">+=</span> args<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    215</span>                 args <span class="ansi-blue-fg">=</span> args<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">--&gt; 216</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">yield</span> <span class="ansi-green-fg">from</span> self<span class="ansi-blue-fg">.</span>_plot_args<span class="ansi-blue-fg">(</span>this<span class="ansi-blue-fg">,</span> kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    217</span> 
<span class="ansi-green-intense-fg ansi-bold">    218</span>     <span class="ansi-green-fg">def</span> get_next_color<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/site-packages/matplotlib/axes/_base.py</span> in <span class="ansi-cyan-fg">_plot_args</span><span class="ansi-blue-fg">(self, tup, kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    340</span> 
<span class="ansi-green-intense-fg ansi-bold">    341</span>         <span class="ansi-green-fg">if</span> x<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">!=</span> y<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 342</span><span class="ansi-red-fg">             raise ValueError(f"x and y must have same first dimension, but "
</span><span class="ansi-green-intense-fg ansi-bold">    343</span>                              f"have shapes {x.shape} and {y.shape}")
<span class="ansi-green-intense-fg ansi-bold">    344</span>         <span class="ansi-green-fg">if</span> x<span class="ansi-blue-fg">.</span>ndim <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">2</span> <span class="ansi-green-fg">or</span> y<span class="ansi-blue-fg">.</span>ndim <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">ValueError</span>: x and y must have same first dimension, but have shapes (100, 1) and (200,)</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA3oAAAHbCAYAAACdjOgaAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjEsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+j8jraAAAgAElEQVR4nO3dfZBdZ30n+O/PSCC3JCTAljBykIxGttKBRDWRg8FJBkLisGRJHJLspnYgmJdyEpOByYaqzQwzG5gdJlU7M8GQhCHO4JjgzCSb7ALFhARnw0sIjjc2GZFAW1g0VoPfZMsgI7ndths/+8e9La7b/XK71ZJax59P1a0jnZfn/M45T9++3z73nFOttQAAANAdZ53uAgAAAFhZgh4AAEDHCHoAAAAdI+gBAAB0jKAHAADQMYIeAABAx6w53QUs1znnnNN27NhxussAAAA4LT73uc8dbq2dO9e0Mzbo7dixI7fccsvpLgMAAOC0qKqJ+ab56iYAAEDHCHoAAAAdI+gBAAB0jKAHAADQMYIeAABAxwh6AAAAHSPoAQAAdIygBwAA0DGCHgAAQMcIegAAAB0j6AEAAHTM0EGvqn66qn6zqj5TVd+sqlZV1y9npVV1flVdW1V3VdXDVXWwqq6uqmcspz0AAAC+bc0S5v1XSb4nybEkdyTZvZwVVtXOJDcm2ZLkI0n2J/m+JG9J8vKqurS1dv9y2gYAAGBpX9385SQXJnl6kl88gXW+N72Q9+bW2uWttV9trf1QkncluSjJO0+gbQAAgCe9oYNea+2TrbUDrbW23JX1z+ZdluRgkt+eNfnXkjyY5DVVtX656wAAAHiyO9U3Y3lpf3hDa+2xwQmttaNJPptkJMklp7guAACAzljKNXor4aL+8LZ5ph9I74zfhUn+8pRUBKwq09PTOXLkSDZv3pw1a071W9Tpd6q2f9j1nK7jMT09ncOHDydJzjnnnBWtcWpqKhMTE9m+fXvWrVu34DqHqWNw/Ulyzz335P7778+znvWsPPvZz16wpplatm3blqmpqWzYsCFHjhzJ9PR01qxZk82bN+fIkSNJcvzfg9OOHTuWDRs25PDhw7n//vuzadOmrFu3Luecc06S5MiRI1m3bl0mJibytKc9LQ8//HC2b9+eY8eOHd+mJEPt62PHjmXfvn05//zzc/755x+fb7l9aeb/GzZsyLFjx47vv6Xs77naGRwePnw4DzzwQHbu3JkkmZiYyKZNm7Jv375ccsklx9e52DbMVevg9h8+fPj4cRnsO4P9Yq6ah+2zC7W1EhaqZ75pw2zDQvttrnkG+/pgn1iNvxPm67+Lbe9qspp/36622lZbPcM61ZVu6g8fmGf6zPjNp6AWYJWZnp7Oddddl/Hx8ezcuTNXXHHFGfWGeqJO1fYPu57TdTymp6fz/ve/Px/+8IeTJJdffnne8IY3rEiNU1NTufLKK3PgwIHs2rUr11xzTdatWzfnOl/72tfmAx/4wIJ1DK5/x44deeSRR/K+970vhw4dytatW/OmN70pV1555Zw1zdRy2223pary4he/OIcOHcqhQ4dy9913Z9u2bXnWs56V+++/P1WVZz7zmTl8+HDuuuuunHfeedm6dWvOO++83Hnnndm3b1/uvfferF27Ni94wQty+eWX5ylPeUq+/OUv5zOf+UwOHTqUb3zjG9m8eXO2bt2azZs356yzzsorX/nKJMlHP/rRBff1sWPH8sM//MPZv39/RkZG8i/+xb/IL/5i73L95fSlV7/61bn++utz4MCB3H333TnvvPPyvOc9L9/61rcWrGWxdrZu3Xp839955535/Oc/n4ceeigvfOELU1U5cOBAbr311iTJli1b8nd/93fZsGHDgtsws87BWnft2pUrrrgiSfL+978/H/rQh3LHHXdk27ZtedWrXpXXvva1uf7664/3iyQ5ePDg42oets/O7mODba3Ez+RCP0PzTRvm526h/Ta7/QMHDuTOO+98XMjftm1bnve856349q6EubZtptavfOUr827varKaf9+uttpWWz1LcUY9R6+qrqyqW6rqlvvuu+90lwOssCNHjmR8fDwXXHBBxsfHj/9198niVG3/sOs5XcfjyJEjGRsbO/7/sbGxFatxYmIiBw4cyM6dO3PgwIFMTEzMu86JiYlF6xhc/9jYWG6++eYcO3YsVXX8DNh8Nc3U8h3f8R356le/mjVr1mT//v2ZmprK5ORkJicnMzY2lunp6Tz66KMZGxvLQw89lMnJyUxNTWX//v3ZuHFjxsbG8s1vfjOttTz44IN56KGHsm/fvoyNjWXjxo05ePBgqioPPfRQzjrrrNx+++2ZnJxMkuzbty/79u1bdF9/4QtfyMGDBzMyMpLJycncfPPN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88wxH9yWxY7VUvricpeZ2cZhf76XaqH95Xchic9EsBoMe43eRf3hbfNMP5DksvS+kvmXJ9hO+u2cUaanp3PddddlfHw8O3fuzBVXXJE1a4a+BJIhzd7Pr371q3P99dc/Yb9PT0/n/e9/fz784Q8nSS6//PK84Q1vOOFjMt9xPtHjP8zyc82TZN5xBw4cyN13353zzjsvu3btelyt11xzTd773vfmwQcfzNatW/MDP/ADueiii+ate6n7c2b+D33oQ7njjjvynOc8J1u2bMm2bdvyvOc9L9/61rfy0Y9+NEnyyle+Mk95ylNy8ODBeaTt3jIAABE3SURBVI/pfNs5uI5t27blVa961fG6BvfXjh07kiQHDx583L/n2teD+2dycjKXXHJJXvSiF+VjH/vY4+r9yle+kjvvvDOHDx9OVeUVr3hF/uZv/iY33XRTpqam8l3f9V35yZ/8yaG2ba59Oz09nSuvvDIHDhzIrl27cs0112TNmjVz9pOpqaknzJvk+LidO3fmxS9+cSYmJh7XJ372Z382V1111ePmuf322/PpT3864+PjOeuss/IjP/Ijufbaa7Nu3bo5f/4+8IEPzNkvZuY9cOBA7rzzztx33325884785znPCcPPPBA7r333qxfvz5XXXVVXv/61x/fLzt27MgjjzyS3/md38mxY8dSVdmyZUsuuuiivPe9780f/MEfzNsP5zvmi+2r2ft1vveV2aampvLGN74xN954Y0ZGRnLVVVflyiuvXPA9YZga5/p5WsoyM9t42223pary/d///Qv+fC/VQu/Dw24T3eYzEawOw57R29QfPjDP9Jnxm09mO1V1ZVXdUlW33HfffYus6tQ6cuRIxsfHc8EFF2R8fDxHjhw53SV10uz9PDExMed+P3LkSMbGxo4vNzY2tiLHZL7jfKLHf5jl55pnoXFbt27NgQMHsnXr1ifUum/fvkxOTuZpT3taDh48mI0bNy5Y91L358z8jz76aCYnJ/PQQw9l//792bp1a8bGxrJv377j8+7bty9jY2MLHtP5tnNwHdPT04+ra3CZsbGx4+sY/Pdc2zy4f84+++yMjY3l5ptvfkK9W7duzf79+/Poo48mSW6++eaMjY3lqU99aiYnJzM1NTX0ts21bycmJo4HsAMHDmRiYmLefjLXvIPj9u/fn3379j2hT3zhC194wjwbN27M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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The losses which were computed above are those obtained during training. Relying on this value may be a dangerous strategy as the model may be overfitting the data. We should therefore measure how the model would generalize with novel data.</p>
<p>While it hard to do with real (experimental) data which are often scarse, here we synthesized the data and we can thus compute a testing loss by drawing again a set of new data and computing the loss on that data:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>    
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c1"># p0=p0, theta0=theta0, wt=wt, </span>
    <span class="c1"># p = p0/2 + (1-p0) / (1+np.exp(-(theta-theta0)/wt))</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>        
    <span class="n">P</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">criterion</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Testing true loss = </span><span class="si">{</span><span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Training loss = </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">Theta</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">theta</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>

    <span class="n">outputs</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Testing loss = </span><span class="si">{</span><span class="n">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_sk</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Training sklearn loss = </span><span class="si">{</span><span class="n">loss_sk</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">loss_sklearn</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">theta</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">outputs_</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">outputs</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs_</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Testing sklearn loss = </span><span class="si">{</span><span class="n">loss_sklearn</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="quantitative-comparison-of-methods-:-varrying-methods'-parameters">quantitative comparison of methods : varrying methods' parameters<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#quantitative-comparison-of-methods-:-varrying-methods'-parameters">¶</a>
</h3>
<p>Let's study the influence of each method's meta-parameter, such as the number of iterations:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-of-learning-rate">influence of learning rate<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-of-learning-rate">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learning_rates</span> <span class="o">=</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">learning_rates_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="n">loss_Ps</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">learning_rate_</span> <span class="ow">in</span> <span class="n">learning_rates</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>

        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>        

        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="o">+</span><span class="n">N_test</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>            
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"learning_rate: </span><span class="si">{</span><span class="n">learning_rate_</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_P: </span><span class="si">{</span><span class="n">loss_P</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">learning_rates_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">learning_rate_</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">3</span><span class="o">/</span><span class="n">N_cv</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#influence du learning rate sur loss</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">learning_rates_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">learning_rates_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'true'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">learning_rates_</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">learning_rates_</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'learning_rate'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'best'</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-du-nombre-d'epochs">influence du nombre d'epochs<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-du-nombre-d'epochs">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_epochss</span> <span class="o">=</span> <span class="n">num_epochs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">num_epochss_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="n">loss_SKLs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">num_epochs_</span> <span class="ow">in</span> <span class="n">num_epochss</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>
        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">num_epochs_</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">num_epochs_</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="o">+</span><span class="n">N_test</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>            
            <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">loss_sklearn</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"num_epochs: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">num_epochs_</span><span class="p">)</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_P: </span><span class="si">{</span><span class="n">loss_P</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_SKL: </span><span class="si">{</span><span class="n">loss_SKL</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">num_epochss_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num_epochs_</span><span class="p">)</span>
        <span class="n">loss_SKLs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_SKL</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># influence du nbr d'epochs sur loss </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_epochss_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_epochss_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_P'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_epochss_</span><span class="p">,</span> <span class="n">loss_SKLs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_SKL'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'# epochs'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'best'</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-of-minibatch-size">influence of minibatch size<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-of-minibatch-size">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch_sizes</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">batch_sizes_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="n">loss_Ps</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">batch_size_</span> <span class="ow">in</span> <span class="n">batch_sizes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>

        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">batch_size_</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="o">+</span><span class="n">N_test</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>            
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"batch_size: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">batch_size_</span><span class="p">)</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_P: </span><span class="si">{</span><span class="n">loss_P</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_SKL: </span><span class="si">{</span><span class="n">loss_SKL</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">batch_sizes_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_size_</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># influence de la taille du minibatch sur loss </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">batch_sizes_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">batch_sizes_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'true'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'batch_size'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss '</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'best'</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-of-beta1">influence of <code>beta1</code><a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-of-beta1">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">beta1s</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">beta1s_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="n">loss_Ps</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">beta1_</span> <span class="ow">in</span> <span class="n">beta1s</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>
        
        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="n">beta1_</span><span class="p">,</span> <span class="n">beta2</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="o">+</span><span class="n">N_test</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>            
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"beta1: </span><span class="si">{</span><span class="n">beta1_</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_P: </span><span class="si">{</span><span class="n">loss_P</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">beta1s_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beta1_</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">beta1s_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">beta1s_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'true'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'beta1'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss '</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'best'</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-of-beta2">influence of <code>beta2</code><a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-of-beta2">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">beta2s</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">beta2s_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="n">loss_Ps</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">beta2_</span> <span class="ow">in</span> <span class="n">beta2s</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>

        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span> <span class="n">beta2_</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="o">+</span><span class="n">N_test</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>            
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"beta2: </span><span class="si">{</span><span class="n">beta2_</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_P: </span><span class="si">{</span><span class="n">loss_P</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">beta2s_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beta2_</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">beta2s_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">beta2s_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'true'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'beta1'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss '</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'best'</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-of-C">influence of <code>C</code><a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-of-C">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Cs</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Cs_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="n">loss_SKLs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">C_</span> <span class="ow">in</span> <span class="n">Cs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>

        <span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="o">+</span><span class="n">N_test</span><span class="p">)</span>
            <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">loss_sklearn</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"C: </span><span class="si">{</span><span class="n">C_</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_SKL: </span><span class="si">{</span><span class="n">loss_SKL</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            
        <span class="n">Cs_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C_</span><span class="p">)</span>
        <span class="n">loss_SKLs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_SKL</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Cs_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'true'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Cs_</span><span class="p">,</span> <span class="n">loss_SKLs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_SKL'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'C'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss '</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'best'</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-of-tol">influence of <code>tol</code><a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-of-tol">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tols</span> <span class="o">=</span> <span class="n">tol</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">tols_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="n">loss_SKLs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">tol_</span> <span class="ow">in</span> <span class="n">tols</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>

        <span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="o">+</span><span class="n">N_test</span><span class="p">)</span>
            <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">loss_sklearn</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"tol: </span><span class="si">{</span><span class="n">tol_</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_SKL: </span><span class="si">{</span><span class="n">loss_SKL</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">tols_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tol_</span><span class="p">)</span>
        <span class="n">loss_SKLs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_SKL</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tols_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'true'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tols_</span><span class="p">,</span> <span class="n">loss_SKLs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_SKL'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'tol'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'best'</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="quantitative-comparison-of-methods-:-varrying-experimental-parameters">quantitative comparison of methods : varrying experimental parameters<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#quantitative-comparison-of-methods-:-varrying-experimental-parameters">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-of-number-of-trials">influence of number of trials<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-of-number-of-trials">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Ns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">Ns_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="n">loss_SKLs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">N_</span> <span class="ow">in</span> <span class="n">Ns</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">N_</span><span class="p">),</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>
        
        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="o">+</span><span class="n">N_test</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>            
            <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">loss_sklearn</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"N: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">N_</span><span class="p">)</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_P: </span><span class="si">{</span><span class="n">loss_P</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_SKL: </span><span class="si">{</span><span class="n">loss_SKL</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">loss_SKLs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_SKL</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">Ns_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N_</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Ns_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Ns_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_P'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Ns_</span><span class="p">,</span> <span class="n">loss_SKLs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_SKL'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">' # trials'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">6</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-of-number-of-theta_std">influence of number of theta_std<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-of-number-of-theta_std">¶</a>
</h4>
<p>The convergence of the fitting procedure may also depend on the parametrers of the data which were set to:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'p0 = </span><span class="si">{</span><span class="n">p0</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, theta0 = </span><span class="si">{</span><span class="n">theta0</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, wt = </span><span class="si">{</span><span class="n">wt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, theta_std = </span><span class="si">{</span><span class="n">theta_std</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">theta_stds</span> <span class="o">=</span> <span class="n">theta_std</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">theta_stds_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="n">loss_SKLs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">theta_std_</span> <span class="ow">in</span> <span class="n">theta_stds</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">theta_std</span><span class="o">=</span><span class="n">theta_std_</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>
        
        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">theta_std</span><span class="o">=</span><span class="n">theta_std_</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="o">+</span><span class="n">N_test</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>            
            <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">loss_sklearn</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"theta_std: </span><span class="si">{</span><span class="n">theta_std_</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_P: </span><span class="si">{</span><span class="n">loss_P</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_SKL: </span><span class="si">{</span><span class="n">loss_SKL</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">loss_SKLs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_SKL</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">theta_stds_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta_std_</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_stds_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_stds_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_P'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_stds_</span><span class="p">,</span> <span class="n">loss_SKLs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_SKL'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">' # trials'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">6</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="influence-of-number-of-p0">influence of number of <code>p0</code><a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#influence-of-number-of-p0">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p0s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-.</span><span class="mi">7</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">p0s_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="n">loss_SKLs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">p0_</span> <span class="ow">in</span> <span class="n">p0s</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">p0</span><span class="o">=</span><span class="n">p0_</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>
        
        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">N_test</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">p0</span><span class="o">=</span><span class="n">p0_</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N_test</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_torch</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">loss_sklearn</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">loss_P</span> <span class="o">=</span> <span class="n">loss_true</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">i_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"theta_std: </span><span class="si">{</span><span class="n">theta_std_</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_P: </span><span class="si">{</span><span class="n">loss_P</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, loss_SKL: </span><span class="si">{</span><span class="n">loss_SKL</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">loss_SKLs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_SKL</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">p0s_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0_</span><span class="p">)</span>
        <span class="n">loss_Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_P</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">/</span><span class="n">loss_P</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_stds_</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_stds_</span><span class="p">,</span> <span class="n">loss_Ps</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_P'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_stds_</span><span class="p">,</span> <span class="n">loss_SKLs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'loss_SKL'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">' # trials'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">6</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="comparing-the-predicted-values">comparing the predicted values<a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#comparing-the-predicted-values">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'p0 = </span><span class="si">{</span><span class="n">p0</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, theta0 = </span><span class="si">{</span><span class="n">theta0</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, wt = </span><span class="si">{</span><span class="n">wt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, theta_std = </span><span class="si">{</span><span class="n">theta_std</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="changing-p0">changing <code>p0</code><a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#changing-p0">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N_scan</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">p0s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-.</span><span class="mi">7</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">p0s_</span><span class="p">,</span> <span class="n">wts_</span><span class="p">,</span> <span class="n">theta0s_</span><span class="p">,</span> <span class="n">p0_tos</span><span class="p">,</span> <span class="n">theta0_tos</span><span class="p">,</span> <span class="n">theta0_sks</span><span class="p">,</span> <span class="n">wt_tos</span><span class="p">,</span> <span class="n">wt_sks</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">p0_</span> <span class="ow">in</span> <span class="n">p0s</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">p0</span><span class="o">=</span><span class="n">p0_</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>
        
        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">theta0_to</span><span class="p">,</span> <span class="n">wt_to</span><span class="p">,</span> <span class="n">p0_to</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">theta0_sk</span><span class="p">,</span> <span class="n">wt_sk</span> <span class="o">=</span> <span class="n">get_params_sk</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">p0s_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0_</span><span class="p">)</span>
        <span class="n">theta0s_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta0</span><span class="p">)</span>
        <span class="n">wts_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="p">)</span>
        <span class="n">p0_tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0_to</span><span class="p">)</span>
        <span class="n">theta0_tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta0_to</span><span class="p">)</span>
        <span class="n">theta0_sks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta0_sk</span><span class="p">)</span>
        <span class="n">wt_tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt_to</span><span class="p">)</span>
        <span class="n">wt_sks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt_sk</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">p0s_</span><span class="p">,</span> <span class="n">p0_tos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">p0s_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">p0s_</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">p0_tos</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">p0_tos</span><span class="p">)],</span> <span class="s1">'--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'p0 (true)'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'p0 (predicted)'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">,</span> <span class="n">theta0_tos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">,</span> <span class="n">theta0_sks</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'sklearn'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">theta0_sks</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta0_sks</span><span class="p">)],</span> <span class="s1">'--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'theta0 (true)'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'theta0 (predicted)'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wts_</span><span class="p">,</span> <span class="n">wt_tos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wts_</span><span class="p">,</span> <span class="n">wt_sks</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'sklearn'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">wts_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">wts_</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">wts_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">wts_</span><span class="p">)],</span> <span class="s1">'--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'slope (true)'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'slope (predicted)'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="changing-theta0">changing <code>theta0</code><a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#changing-theta0">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N_scan</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">theta0s</span> <span class="o">=</span> <span class="n">theta_std</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">p0s_</span><span class="p">,</span> <span class="n">wts_</span><span class="p">,</span> <span class="n">theta0s_</span><span class="p">,</span> <span class="n">p0_tos</span><span class="p">,</span> <span class="n">theta0_tos</span><span class="p">,</span> <span class="n">theta0_sks</span><span class="p">,</span> <span class="n">wt_tos</span><span class="p">,</span> <span class="n">wt_sks</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">theta0_</span> <span class="ow">in</span> <span class="n">theta0s</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">theta0</span><span class="o">=</span><span class="n">theta0_</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>
        
        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">theta0_to</span><span class="p">,</span> <span class="n">wt_to</span><span class="p">,</span> <span class="n">p0_to</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">theta0_sk</span><span class="p">,</span> <span class="n">wt_sk</span> <span class="o">=</span> <span class="n">get_params_sk</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">p0s_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">theta0s_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta0_</span><span class="p">)</span>
        <span class="n">wts_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="p">)</span>
        <span class="n">p0_tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0_to</span><span class="p">)</span>
        <span class="n">theta0_tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta0_to</span><span class="p">)</span>
        <span class="n">theta0_sks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta0_sk</span><span class="p">)</span>
        <span class="n">wt_tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt_to</span><span class="p">)</span>
        <span class="n">wt_sks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt_sk</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">p0s_</span><span class="p">,</span> <span class="n">p0_tos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">p0s_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">p0s_</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">p0_tos</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">p0_tos</span><span class="p">)],</span> <span class="s1">'--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'p0 (true)'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'p0 (predicted)'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">,</span> <span class="n">theta0_tos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">,</span> <span class="n">theta0_sks</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'sklearn'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">theta0_sks</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta0_sks</span><span class="p">)],</span> <span class="s1">'--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'theta0 (true)'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'theta0 (predicted)'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wts_</span><span class="p">,</span> <span class="n">wt_tos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wts_</span><span class="p">,</span> <span class="n">wt_sks</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'sklearn'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">wts_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">wts_</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">wts_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">wts_</span><span class="p">)],</span> <span class="s1">'--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'slope (true)'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'slope (predicted)'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="changing-wt">changing <code>wt</code><a class="anchor-link" href="2020-04-08-fitting-a-psychometric-curve-using-pytorch.html#changing-wt">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N_scan</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">wts</span> <span class="o">=</span> <span class="n">wt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_scan</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">p0s_</span><span class="p">,</span> <span class="n">wts_</span><span class="p">,</span> <span class="n">theta0s_</span><span class="p">,</span> <span class="n">p0_tos</span><span class="p">,</span> <span class="n">theta0_tos</span><span class="p">,</span> <span class="n">theta0_sks</span><span class="p">,</span> <span class="n">wt_tos</span><span class="p">,</span> <span class="n">wt_sks</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">wt_</span> <span class="ow">in</span> <span class="n">wts</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i_CV</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_cv</span><span class="p">):</span>
        <span class="n">theta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">wt</span><span class="o">=</span><span class="n">wt_</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="n">i_CV</span><span class="p">)</span>
        
        <span class="n">logistic_model</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">loss_SKL</span> <span class="o">=</span> <span class="n">fit_data_sklearn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">theta0_to</span><span class="p">,</span> <span class="n">wt_to</span><span class="p">,</span> <span class="n">p0_to</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="n">logistic_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">theta0_sk</span><span class="p">,</span> <span class="n">wt_sk</span> <span class="o">=</span> <span class="n">get_params_sk</span><span class="p">(</span><span class="n">logistic_model_sk</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">p0s_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">theta0s_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta0</span><span class="p">)</span>
        <span class="n">wts_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt_</span><span class="p">)</span>
        <span class="n">p0_tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0_to</span><span class="p">)</span>
        <span class="n">theta0_tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta0_to</span><span class="p">)</span>
        <span class="n">theta0_sks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta0_sk</span><span class="p">)</span>
        <span class="n">wt_tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt_to</span><span class="p">)</span>
        <span class="n">wt_sks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt_sk</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">p0s_</span><span class="p">,</span> <span class="n">p0_tos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">p0s_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">p0s_</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">p0_tos</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">p0_tos</span><span class="p">)],</span> <span class="s1">'--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'p0 (true)'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'p0 (predicted)'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">,</span> <span class="n">theta0_tos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">,</span> <span class="n">theta0_sks</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'sklearn'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta0s_</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">theta0_sks</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">theta0_sks</span><span class="p">)],</span> <span class="s1">'--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'theta0 (true)'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'theta0 (predicted)'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wts_</span><span class="p">,</span> <span class="n">wt_tos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'torch'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wts_</span><span class="p">,</span> <span class="n">wt_sks</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'sklearn'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">wts_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">wts_</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">wts_</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">wts_</span><span class="p">)],</span> <span class="s1">'--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'slope (true)'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'slope (predicted)'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../categories/numpy.html" rel="tag">numpy</a></li>
            <li><a class="tag p-category" href="../categories/open-science.html" rel="tag">open-science</a></li>
            <li><a class="tag p-category" href="../categories/orientation.html" rel="tag">orientation</a></li>
            <li><a class="tag p-category" href="../categories/psychophysics.html" rel="tag">psychophysics</a></li>
            <li><a class="tag p-category" href="../categories/pytorch.html" rel="tag">pytorch</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="2020-01-08-changing-the-global-phase-of-a-motion-cloud.html" rel="prev" title="Changing the global phase of a Motion Cloud">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="invibe",
            disqus_url="https://laurentperrinet.github.io/sciblog/posts/2020-04-08-fitting-a-psychometric-curve-using-pytorch.html",
        disqus_title="2020-04-08 fitting a psychometric curve using pyTorch",
        disqus_identifier="cache/posts/2020-04-08-fitting-a-psychometric-curve-using-pytorch.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    },
    displayAlign: 'center', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article><script>var disqus_shortname="invibe";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2020 <a href="mailto:laurent.perrinet@univ-amu.fr">Laurent Perrinet</a> -
Powered by <a href="http://getnikola.com">Nikola</a> with <a href="https://themes.getnikola.com/v7/maupassant/">Maupassant</a> theme <br><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/ar/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="http://i.creativecommons.org/l/by-nc-sa/2.5/ar/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
